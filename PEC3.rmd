---
title: "PEC3"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```




# Sección 1 (8 puntos) 

**1. (0,5 puntos)  Buscad un conjunto de datos relacionados con la Bioestadística o Bioinformática. Para ello, podéis utilizar algunos recursos conocidos como es el caso de http://www.bioinformatics.org/sms2/index.html o de http://biostat.mc.vanderbilt.edu/wiki/Main/DataSets.  **
**También podéis utilizar otros recursos propios que conozcáis o que sean de vuestro interés, y siempre teniendo en cuenta que sean datos públicos que podéis utilizar.  Tenéis que explicar la procedencia de los datos así como incluir las referencias que correspondan y justificar porqué habéis elegido estos datos.** 

<div style="text-align: justify">
Una comprensión holística de los fenómenos ecológicos implica reducir la complejidad natural en factores y relaciones interpretables. Este reduccionismo viene facilitado por la elaboración de modelos matemáticos que permiten la comprensión de dichos fenómenos, la obtención de conclusiones y la elaboración de predicciones. Típicamente, los sistemas ecológicos han sido clasificados según su dinámica en sistemas en equilibrio y sistemas en no-equilibrio, de tal manera que aquellos cambios reversibles pertenecerían a un sistema en equilibrio, y los cambios no reversibles a los sistemas en no-equilibrio. El aumento de la capacidad computacional ha permitido durante las dos últimas décadas abordar modelos multinivel más complejos, que, si bien eran conocidos, no eran aplicables debido una insuficiente capacidad de cálculo. Estos nuevos enfoques determinan que las dinámicas ecológicas están englobadas en un continuo equilibrio, no-equilibrio; en vez de dos estados contrapuestos.  


Las llanuras de Rehoboth, en Namibia central, han permitido a algunos investigadores desarrollar estos nuevos modelos. Esta región semi-árida de estepa y poca vegetación, ha sido durante cientos de años, y sigue siendo hoy en día, zona de pastoreo. A pesar de su contribución reducida al Producto Interior Bruto (PIB), la agricultura es un sector que se mantiene como fundamental para la mayoría de la población (algo más de dos millones de habitantes en 2019). De forma directa o indirecta, mantiene aproximadamente al 70% de la población del país.   [http://www.fao.org/namibia/fao-in-namibia/namibia-at-a-glance/en/]  


La elaboración de modelos que permitan realizar una explotación óptima de la estepa, a la vez que mantienen la dinámica de los pastizales, puede suponer enormes beneficios sobre la economía y salud de las personas.
Nuestra atención se centra en el estudio elaborado por Wesuls, D. et al [1], y los datos obtenidos a partir de este (que se pueden encontrar en el repositorio "biosphere" en el paquete *ade4* de R). Este estudio, emplea un conjunto jerárquico de modelos ecológicamente significativos con una complejidad creciente: el enfoque HOF (Huisman – Olff – Fresco) [enlace], para investigar las respuestas de pastoreo de las especies, los parámetros de diversidad y los valores de cobertura agrupados para dos rasgos: forma de crecimiento y ciclo de vida.
1.*The grazing fingerprint: Modelling species responses and trait patterns alonggrazing gradients in semi-arid Namibian rangelands*  
<div/>  

In order to study grazing-induced changes in plant species composition, vegetation structure, diversity patterns or soil parameters the piosphere approach has been frequently applied in studies in many semi-arid regions around the world (Perkins & Thomas 1993; Landsberg et al. 2003; Todd 2006; Sasaki et al. 2008).

In the present study, we investigated the influence of
livestock grazing on the distribution of plant traits in a
semi-arid African savanna ecosystem. 


Our study area comprises ten farms in central Namibia,
southern Africa (Fig. 1) near the town of Rehoboth (23.3°
S, 17.1°E). It is located in the Namibian Central Highland
foothills (ca. 1400 m a.s.l.) with a relatively flat topography and scattered mountainous terrain. The climate is
semi-arid, with an average annual rainfall ranging from
200 to 300 mm, typically occurring during the summer
months of Dec to Mar. The rainfall is highly variable spatially and temporally, with a coefficient of variation of up
to 40% (Mendelsohn et al. 2002). The average daily temperatures range from 17 °C in the winter months to 25 °C
in summer. Soils vary from sandy to loamy. Dominant soil
types are deep arenosols, shallow leptosols, calcisols and
regosols. The study sites belong to the Nama-Karoo biome
of southern Africa (Rutherford & Westfall 1994).
[Wesus et al]




![image](https://github.com/practicaUOC/trabajo_practica/blob/master/portada.jpg?raw=true)



**2. (0,5 puntos) Utilizando R, mostrad y explicad qué tipo de fichero habéis importado y las variables que forman parte de él (tipo, clasificación,...), así como todo aquello que creáis relevante. Incluir capturas de pantalla y las instrucciones en R que habéis utilizado para importar y  mostrar los datos.** 

Hemos utilizado un dataset que pertenece al paquete de R llamado ade4.  La manera de importar es con la función *data* del paquete base de R. En este caso no es necesario utilizar funciones como read.delim, read.csv o read.table de las utilidades de R que son las habituales para importar ficheros de texto, o la función read.xlsx de la librería xlsx para importar ficheros en formato excel, o read.spss del paquete foreign para leer ficheros procedentes del paquete estadístico SPSS.

La particularidad de este dataset es que viene definido a través de un objeto *lista* llamado *piosphere*. 
Este objeto lista está formado a su vez por cuatro objetos

<!-- La presión que ejercen los animales sobre los recursos, no se presenta -->
<!-- uniformemente a lo largo del lote, esta ampliamente aceptado que la presión es -->
<!-- mayor cerca de los puntos en donde los animales se reúnen a beber. Lange -->
<!-- (1969) emplea el termino “piosfera” para describir esta relación entre las -->
<!-- aguadas y los animales en pastoreo. Por lo tanto se entiende como piosfera al -->
<!-- sitio que rodea los puntos de bebidas en donde la presión por pastoreo sobre el -->
<!-- suelo y la vegetación, es muy intensa y esta presión disminuye con distancias -->
<!-- crecientes a los puntos de bebida.  -->

- Data frame que se llama **veg** que tiene la información sobre la proporción de cada  cada una de las especies en la superficie superior de la vegetación. Cada una de las filas se corresponde a los datos de las piosferas elegidas. Tenemos 378 piosferas y 87 tipos de especies.

- Data frame que se llama **traits** que tiene la información de las características o rasgos de las plantas. Cada una de las filas se corresponde a los valores de las columnas del data frame **veg**. Es decir en este data frame tendremos 87 filas y 21 características

- Data frame que se llama **env** que contiene la información de variables medioambientales relativas a las 378 piosferas que se han estudiado. Se han recopilado 25 variables

- Vector llamado **habitat** es una variable tipo factor que describe el tipo de habitat de cada una de las piosferas.

```{r carga_librerias,echo=T, message=F, warning=F,comment=F}
require(ade4)
library(ade4)
library(dplyr)
library(ggplot2)
library(kableExtra)
library(captioner)
library(ade4)
library(gridExtra)
library(pROC)
library(cutpointr)
ind.tabla<-1
ind.figura<-0
table_nums <- captioner(prefix = "Tabla.")
```


```{r echo=T, message=F, warning=F,comment=F}
data("piosphere")
```


```{r echo=F}
tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
piosphere$veg %>% head() %>% kable(caption = paste0(tab.1_cap,"Primeras seis filas de Data Frame veg")) %>% kable_styling()
ind.tabla <- increment(ind.tabla,1)

tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
piosphere$veg %>% tail() %>% kable(caption = paste0(tab.1_cap,"Últimas seis filas de Data Frame veg")) %>% kable_styling()
ind.tabla <- increment(ind.tabla,1)
```

```{r echo=F}
tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
piosphere$traits %>% head() %>% kable(caption = paste0(tab.1_cap,"Primeras seis filas de Data Frame traits")) %>% kable_styling()
ind.tabla <- increment(ind.tabla,1)
```


```{r echo=F}
tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
sapply(piosphere$traits,class)%>% kable(caption = paste0(tab.1_cap,"Clasificación de las variables que definen los rasgos de las especies"),col.names = "Tipo de Variable") %>% kable_styling()
ind.tabla <- increment(ind.tabla,1)
```


```{r echo=F}
tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
piosphere$env %>% head() %>% kable(caption = paste0(tab.1_cap,"Primeras seis filas de Data Frame env")) %>% kable_styling()
ind.tabla <- increment(ind.tabla,1)

tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
sapply(piosphere$env,class)%>% kable(caption = paste0(tab.1_cap,"Clasificación de las variables que definen las variables medioambientales recogidas"),col.names = "Tipo de Variable") %>% kable_styling()
ind.tabla <- increment(ind.tabla,1)
```

```{r echo=F}
tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
piosphere$habitat %>% head() %>% kable(caption = paste0(tab.1_cap,"Primeros seis elementos de Vector habitat"),col.names = "Tipo de Habitat") %>% kable_styling()
ind.tabla <- increment(ind.tabla,1)
```


**3. (1,5 puntos) Realizad un mínimo de seis preguntas objetivo que den una idea de la información contenida en el conjunto de datos escogido, es decir, obtener información del conjunto de datos a partir de determinados criterios, según variables, o rangos de valores, etc... Para ello, podéis basaros en el tipo de consultas realizadas en la PEC1 y también utilizando, en alguno de los casos, la definición de funciones tal como se trabaja en el LAB3.**

- Mostrar el porcentaje de especies que tienen datos en cada una de las piosferas, y extraer el número de especies que la ocupan para poder estudiar posteriormente la relación del número de especies en una piosfera con las características de dicha piosfera

```{r echo=F}
tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
apply(piosphere$veg ,MARGIN = 1,FUN=function(x){round(100*(sum(x!=0)/ncol(piosphere$veg)),2)}) %>% head() %>%  kable(colnames="Porcentaje",caption = paste0(tab.1_cap,"Porcentaje de Especies con datos en cada piosfera")) %>% kable_styling() %>%  add_footnote("Se muestran sólo seis primeras filas", notation="alphabet")
ind.tabla <- increment(ind.tabla,1)
```

```{r echo=F}
tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
apply(piosphere$veg ,MARGIN = 1,FUN=function(x){sum(x!=0)}) %>% head() %>% kable(colnames="Número",caption = paste0(tab.1_cap,"Número de Especies con datos en cada piosfera"))  %>% kable_styling()%>%  add_footnote("Se muestran sólo seis primeras filas", notation="alphabet")
ind.tabla <- increment(ind.tabla,1)
```

- Mostrar la especie mayoritaria en cada una de las especies

```{r echo=F}
tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
especie<-colnames(piosphere$veg)[apply(piosphere$veg,1,which.max)]
porcentaje<-apply(piosphere$veg,1,max)
data.frame(`Especie Mayoritaria`=especie,Porcentaje=porcentaje) %>% head() %>% kable(colnames=c("Especie Mayoritaria", "Porcentaje"),caption = paste0(tab.1_cap,"Especie mayoritaria en cada piosfera")) %>% kable_styling()%>%  add_footnote("Se muestran sólo seis primeras filas", notation="alphabet")
ind.tabla <- increment(ind.tabla,1)
```

- Mostrar la especie que tiene el valor maximo para cada una de las caracteristicas numericas del data.frame traits 

```{r echo=F}
tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
caracteristicas.numericas<-sapply(piosphere$traits,class)
caracteristicas.numericas<-names(caracteristicas.numericas)[caracteristicas.numericas=="numeric"]
especie<-rownames(piosphere$traits)[apply(piosphere$traits[,caracteristicas.numericas],2,which.max)]
data.frame(`Caracteristica`=caracteristicas.numericas,Especie=especie)%>% head() %>% kable(colnames=c("Especie Mayoritaria", "Porcentaje"),caption = paste0(tab.1_cap,"Especies con mayores caracteristicas")) %>% kable_styling()%>%  add_footnote("Se muestran sólo seis primeras filas", notation="alphabet")
ind.tabla <- increment(ind.tabla,1)
```

- Mostrar que especies cuyo ciclo vital es anual tienen consistencia de hoja mesomórfica suave


```{r echo=F}
tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
piosphere$traits %>% dplyr::mutate(especie=rownames(.)) %>%  dplyr::filter(life.cycle=="annual") %>% dplyr::filter(leaf.consistency=="soft-mesomorphic") %>% dplyr::select(especie) %>% head() %>% kable(colnames=c("Especie"),caption = paste0(tab.1_cap,"Especies ciclo vital anual y con consistencia de hoja mesomórfica suave")) %>% kable_styling()%>%  add_footnote("Se muestran sólo seis primeras filas", notation="alphabet")
ind.tabla <- increment(ind.tabla,1)
```

- Mostrar que piosferas tienen mayor inclinacion de la media

```{r echo=F}
tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
media.inclinacion<-mean(piosphere$env$Inclination,na.rm=T)
piosphere$env %>% dplyr::mutate(piosfera=rownames(.)) %>%  dplyr::filter(Inclination>media.inclinacion) %>% dplyr::select(piosfera,Inclination) %>% head() %>% kable(colnames=c("Piosfera","Inclination"),caption = paste0(tab.1_cap,"Piosferas con mayor inclinación que la media")) %>% kable_styling()%>%  add_footnote("Se muestran sólo seis primeras filas", notation="alphabet")
ind.tabla <- increment(ind.tabla,1)
```

- Mostrar que piosferas tienen valores nitritos, nitratos y phosphatos por encima del 75%

```{r echo=F}
tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
p75.nitritos<-quantile(piosphere$env$NO2,probs = 0.75)
p75.nitratos<-quantile(piosphere$env$NO3,probs = 0.75)
p75.phosphatos<-quantile(piosphere$env$PO4,probs = 0.75)


piosphere$env %>% dplyr::mutate(piosfera=rownames(.)) %>%  dplyr::filter(NO2>p75.nitritos & NO3>p75.nitratos&PO4>p75.phosphatos) %>% dplyr::select(piosfera,NO2,NO3,PO4) %>% kable(colnames=c("Piosfera","NO2","NO3","NO4"),caption = paste0(tab.1_cap,"Piosferas con valores superiores al 3er cuartil en nitritos, nitratos y phosphatos")) %>% kable_styling()
ind.tabla <- increment(ind.tabla,1)
```


- A colación de este, mostrar la distribución de pH, a que piosferas pertenecen la correlación con los nutrientes. (ej6)
```{r}

plot(piosphere$env[piosphere$env$PO4!=0,]$pH,piosphere$env[piosphere$env$PO4!=0,]$PO4)
```


- Limitaciones de los índices de diversidad (simpson) en el contexto agronómico.
[http://www.umass.edu/landeco/research/fragstats/documents/Metrics/Diversity%20Metrics/Limitations.htm] 


**4. (1,5 puntos) Realizad un análisis descriptivo de los datos. Este estudio debe incluir, un resumen paramétrico de los datos y diversas representaciones gráficas de los mismos basadas en determinados criterios. Dejamos a vuestra elección el tipo de gráficos y los criterios utilizados.**
<div style="text-align: justify">

Para los diferentes data frames contenidos en la lista *piosphere*, vamos a realizar un estudio obteniendo parámetros de tendencia central y dispersión, así como representaciones gráficas para algunas de sus variables, y distribuciones de frecuencias cuando sea necesario; lo cual nos permitirá una aproximación intuitiva a las particularidades de nuestros datos.
<div/>  

Obtenemos tres data frames para cada una de las listas.

```{r echo=T}
veg <- piosphere$veg
traits <- piosphere$traits
env <- piosphere$env
```



#Con respecto al df veg, previo al análisis paramétrico es necesario tratar los datos.
#No se me ocurre una alternativa a agrupar las diferentes subáreas.

Vamos a crear un nuevo data frame con los valores medios por área.
```{r eval=T}

```

```{r eval=F}
ggplot(data=veg.means, aes(x=Era_por)) + 
  geom_histogram(col="black", 
                 fill="steelblue", 
                 alpha = .6) + 
  labs(title="Aca_eri", x="Concentración", y="Frecuencia")
```



Para el data frame **traits** nos vamos a centrar en algunas de las variables que nos parecen significativas en su contexto ecológico.

Las variables 

- *height* 
- *SLA* *(leaf traits)*
- *diaspore length* 
- *life cycle* 
- *Growth Form*

nos van a proporcionar información sobre el conjunto de especies englobadas en nuestro dataset, e incluso, sobre las características del bioma al que pertenecen. 

Comprobamos la normalidad de las tres variables continuas.

```{r}
apply(traits[,c("height","SLA","diaspore.length")],MARGIN = 2,FUN = shapiro.test)

```

Vemos que al analizar las tres variables podemos rechazar la hipotesis que sigan una distribución normal (p valor < 0.05 en el test de Shapiro Wilk)


En la siguiente tabla mostramos los descriptivos para las tres variables. En nuestro caso al tratarse de variables no paramétricas fijaremos la atención en la mediana como medida de centralidad, y el recorrido intercuartílico y el rango como medidas de dispersión.

```{r}
tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
traits %>% dplyr::select(height,SLA,diaspore.length) %>% psych::describe() %>% kableExtra::kable(caption = paste0(tab.1_cap,"Descripción de variable height,SLA y Diaspore Length")) %>% kableExtra::kable_styling()
ind.tabla <- increment(ind.tabla,1)
```


Mostramos otra alternativa, con funciones del paquete base de R para obtener los descriptivos más interesantes

Variable *height*

```{r cuatro_traits}
#Medidas de distribución
range(traits$height)
quantile(traits$height)

#Medidas de centralidad y dispersión
mean(traits$height)
median(traits$height)
sd(traits$height)

#Histograma
plot.height<-ggplot(data=traits, aes(x=height)) + 
  geom_histogram(breaks=seq(0, 400, by=50), 
                 col="black", 
                 fill="steelblue", 
                 alpha = .6) + 
  labs(title="Histograma para las alturas", x="Altura", y="Frecuencia")
```


Variable SLA

```{r}
#Medidas de distribución
range(traits$SLA)
quantile(traits$SLA)


#Medidas de centralidad y dispersión
mean(traits$SLA)
median(traits$SLA)
sd(traits$SLA)


#Histograma
plot.sla<-ggplot(data=traits, aes(x=SLA)) + 
  geom_histogram(col="black", 
                 fill="darkgreen", 
                 alpha = .6) + 
  labs(title="Histograma para SLA", x="SLA", y="Frecuencia")
```

En el siguiente gráfico mostramos los histogramas de la distribución de las variables Height y SLA

```{r echo=F, fig.cap="Histogramas para las variables Height y SLA"}
cowplot::plot_grid(plot.height, plot.sla)
```


Para la variable *diaspore length* tomaremos logaritmos para comprobar si se cumplen criterios de normalidad


```{r, warning=FALSE}
#Medidas de distribución
attach(traits)
range(diaspore.length)
quantile(diaspore.length)
#Medidas de centralidad y dispersión
mean(diaspore.length)
median(diaspore.length)
sd(diaspore.length)

#Histograma en log
logDhist <- ggplot(data=traits, aes(x=log(traits$diaspore.length))) + 
  geom_histogram(col="black", 
                 fill="darkgreen", 
                 alpha = .6,
                 binwidth=0.5) + 
  labs(title="Longitud de las diásporas", x="Longitud de la diáspora", y="Frecuencia")


#Boxplot en log
logDboxplot <- ggplot(data=traits, aes(y=log(traits$diaspore.length))) + 
  geom_boxplot(col="black", 
                 fill="darkgreen", 
                 alpha = .6,
                 binwidth=5) + 
  labs(title="Longitud de las diásporas", y="Longitud", x="Diáspora")
```


```{r echo=F, warning=FALSE, fig.cap="Histograma y Gráfico de Cajas para la variable Longitud de la diáspora transformada en logaritmos"}
grid.arrange(logDhist, logDboxplot, ncol=2)
```

Describimos las variables categóricas **Lyfe Cycle**  y **Growth Form** utilizando tablas de frecuencias relativas

Variable **Lyfe Cycle**  

```{r echo=F}
#Frecuencias y proporciones
tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
table(traits$life.cycle) %>% kable(col.names = c("Life Cycle","Freq"),caption=paste0(tab.1_cap,"Tabla de frecuencias absolutas de la variable Life Cycle")) %>% kable_styling()
# table(traits$life.cycle)/sum(table(traits$life.cycle)) %>% kable() %>% kable_styling()
ind.tabla <- increment(ind.tabla,1)
tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
round(100*prop.table(table(traits$life.cycle)),4) %>% kable(col.names = c("Life Cycle","Proporción"),caption=paste0(tab.1_cap,"Tabla de frecuencias relativas de la variable Life Cycle")) %>% kable_styling()
ind.tabla <- increment(ind.tabla,1)
```

```{r, fig.cap="Barplot de la variable Life Cycle"}
p<-table(traits$life.cycle) %>% data.frame() %>% ggplot(aes(x=Var1, y=Freq)) +
  geom_bar(stat="identity", fill="steelblue")+
  theme_minimal()+xlab("Life Cycle")+ylab("Frecuencia")
p
```


Variable **Growth Form**  
```{r echo=F}
tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
tabla.1<-table(traits$growth.form) 
# table(traits$life.cycle)/sum(table(traits$life.cycle)) %>% kable() %>% kable_styling()
tabla.2<-round(100*prop.table(table(traits$growth.form)),2) 
cbind(tabla.1,tabla.2) %>% kable(col.names = c("n","%"),caption=paste0(tab.1_cap,"Tabla de frecuencias relativas y absolutas de la variable Growth Form")) %>% kable_styling()
ind.tabla <- increment(ind.tabla,1)

```

```{r echo=F,  fig.cap="Barplot de la variable Growth Form"}
p<-round(100*prop.table(table(traits$growth.form)),4) %>% data.frame() %>% ggplot(aes(x=Var1, y=Freq)) +
  geom_bar(stat="identity", fill="steelblue")+
  theme_minimal()+xlab("Growth form")+ylab("Proporción")
p
```


**Dataframe Env**
<div style="text-align: justify">
Las variables fisico-químicas nos van a proporcionar una información amplia sobre los requerimientos nutricionales y ambientales que puede presentar nuestra muestra de estudio, y la flora de la región a la que pertenece. Va a ser fundamental en la elaboración de hipótesis y la obtención de conclusiones.  A continuación presentamos las proporciones, así como parámetros de centralidad y dispersión, y representaciones gráficas para algunas de las variables.
<div/>  

Comprobamos la normalidad de las tres variables

```{r}
apply(env[,c("pH","NO2","NO3","PO4")],MARGIN = 2,FUN = shapiro.test)
```

Podemos rechazar la hipotesis de normalidad de las cuatro variables ya que el p-valor en el test de Shapiro-Wilk es inferior a 0.05.

En la siguiente tabla mostramos los descriptivos principales de la variable, como sucedía con el data frame traits, al tratarse de variables no paramétricas centraremos nuestra atención en la mediana, y tanto en el rango como en el rango intercuartílico
```{r}
tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
env %>% dplyr::select(pH,NO2, NO3, PO4) %>% psych::describe() %>% kableExtra::kable(caption = paste0(tab.1_cap,"Descripción de variable pH,NO2,NO3,PO4")) %>% kableExtra::kable_styling()
ind.tabla <- increment(ind.tabla,1)
```


Variable **pH**

```{r cuatro_env}
#Medidas de distribución
range(env$pH)
quantile(env$pH)


#Medidas de centralidad y dispersión
mean(env$pH)
median(env$pH)
sd(env$pH)
```

Podemos ver en el siguiente gráfico la distribución del pH en las piosferas analizadas, y destaca la bimodalidad observada, viendose dos picos en el histograma en torno al valor 4,7 y el valor 7.

```{r echo=F, message=F, fig.cap="Histograma del pH"}
#Histograma
ggplot(data=env, aes(x=pH)) + 
  geom_histogram(col="black", 
                 fill="steelblue", 
                 alpha = .6) + 
  labs(title="Histograma para el pH", x="pH", y="Frecuencia")
```

Al analizar el la distribución del pH según el tipo de habitat podemos ver un claro efecto del habitat calc en el que se observan niveles de pH alto, quizá esto sea el origen de la bimodalidad que habíamos visto en el gráfico anterior.

```{r echo=F, message=F, fig.cap="Histograma pH por tipo de habitat"}
#Histograma
df.ph.habitat<-data.frame(pH=piosphere$env$pH,habitat=piosphere$habitat)

df.ph.habitat %>% ggplot( aes(x=pH,fill=habitat)) + 
  geom_histogram(col="black", 
                 fill="steelblue", 
                 alpha = .6) + labs(title="Histograma para el pH", x="pH", y="Frecuencia")+facet_wrap(~habitat,ncol = 1,nrow=4)
```


Variable **nutrients**

```{r}

#Medidas de Distribución, NO2, NO3, PO4
range(env$NO2)
quantile(env$NO2)

range(env$NO3)
quantile(env$NO3)

range(env$PO4)
quantile(env$PO4)


#Medidas de centralidad y dispersión  NO2, NO3, PO4
mean(env$NO2)
sd(env$NO2)

mean(env$NO3)
sd(env$NO3)

mean(env$PO4)
sd(env$PO4)
```


Representaciones gráficas

Lo que podemos ver en la distribución de las variables NO2, NO3 y PO4  parecen seguir una distribución gamma.

```{r echo=F, message=F, fig.cap="Histogramas de las variables relativas a los nutrientes"}
#Representaciones gráficas
nut1 <- ggplot(data=env, aes(x=NO2)) + 
  geom_histogram(col="black", 
                 fill="darkorange", 
                 alpha = .6) + 
  labs(title="Concentración NO2", x="NO2", y="Frecuencia")
  

nut2 <- ggplot(data=env, aes(x=NO3)) + 
  geom_histogram(col="black", 
                 fill="darkorange", 
                 alpha = .6) + 
  labs(title="Concentración NO3", x="NO3", y="")

nut3 <- ggplot(data=env, aes(x=PO4)) + 
  geom_histogram(col="black", 
                 fill="darkorange", 
                 alpha = .6) + 
  labs(title="Concentración PO4", x="PO4", y="")


grid.arrange(nut1, nut2, nut3, ncol=3)
```



**5. (1 punto) Realizad, basándoos en los conceptos trabajados en el LAB4 y PEC2, un mínimo de tres enunciados que respondan a una cuestión de probabilidad y un mínimo de un enunciado que corresponda a un breve modelo de simulación. En este caso, si vuestro conjunto de datos no propicia estos enunciados, podéis generar una o diversas distribuciones en base a unos parámetros determinados definidos por vosotros. **

#### Cuestiones relativas a probabilidad

Vamos a *suponer* que el logaritmo de la distancia al punto de agua siguiera una distribución normal de media `r round(median(piosphere$env$logDist),2)` y desviación típica `r round(sd(piosphere$env$logDist),2)`

Calcularemos la probabilidad de que un punto de agua (en logaritmo) este a una distancia inferior a 4 metros.

```{r}
cuestion.1<-pnorm(q = 4,mean = mean(piosphere$env$logDist),sd = sd(piosphere$env$logDist))
```
La probabilidad de que un punto de agua este a una distancia inferior a 4 metros es de `r cuestion.1`


Calcularemos la probabilidad de que un punto de agua (en logaritmo) este a una distancia superior a 8 metros.

```{r}
cuestion.2<-1-pnorm(q = 8,mean = mean(piosphere$env$logDist),sd = sd(piosphere$env$logDist))
```
La probabilidad de que un punto de agua este a una distancia superior de 8 metros es de `r cuestion.2`


Vamos a tener que hacer un análisis de las diferentes especies que tenemos, suponemos que el análisis de una caracteristica como la posición de la flor (variable position.flower) no es fácil de medir y queremos ver cual de las otras caractéristicas(continuas) de las flores nos sirven para predecir con buena probabilidad la posición de la flor.

Utilizando la técnica de curvas ROC primero buscaremos cual es la característica que nos da un AUC mayor 
<!-- control = exposed, case = not exposed -->


```{r message=F}
tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
piosphere$traits %>% select(leaf.ratio,flower.position)
tipos.de.variables<-sapply(piosphere$traits,class)
variables.estudio<-colnames(piosphere$traits)[tipos.de.variables=="numeric"]
lista.de.curvas.roc<-lapply(variables.estudio,FUN=function(variable){
roc_obj <- pROC::roc(piosphere$traits$flower.position, piosphere$traits[,variable])  
})
names(lista.de.curvas.roc)<-variables.estudio
lista.auc<-sapply(lista.de.curvas.roc,FUN=function(curva.roc){curva.roc$auc})
names(lista.auc)<-variables.estudio
data.frame(lista.auc) %>% kable(col.names = "AUC",caption=paste0(tab.1_cap,"AUC de las variables predictoras")) %>% kable_styling()
ind.tabla<-increment(ind.tabla,1)

```

Observamos que la carácteristica con mayor AUC es el ratio de la hoja.

Los datos exactos para la prueba los vemos en la siguiente tabla. Podemos decir que si el ratio de la hoja es menor de 23,28 la probabilidad que nuestra posición de la flor sea  no expuesta es del 100% ya que la especificidad de nuestro test es de 1.

También podemos decir que si el ratio de la hoja es mayor de 23,28 con una probabilidad del 37,87% la posición de la flor será expuesta.

Con una probabilidad del 75,86% la posición floral en nuestra muestra es expuesta.


```{r}
tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
cp <- cutpointr(data = piosphere$traits,class = flower.position , x = leaf.ratio, 
                method = maximize_metric, metric = sum_sens_spec)
cp %>% kable(caption=paste0(tab.1_cap,"Estadisticos relativos a la curva ROC")) %>% kable_styling()
ind.tabla<-increment(ind.tabla,1)
```


#### Cuestión relativa a simulación 

- Suponemos que tenemos que elegir 40 piosferas para hacer un subanalisis, de las cuales 8 tienen que ser calc, 16 sand07, 8 sand08, y 8 stone. Haremos una simulación de extracción y comprobaremos si alguna de las muestras elegidas cumple esos criterios.


```{r}
set.seed(385)
seleccion_muestras<-replicate(n = 1000,{muestra=sample(x = rownames(piosphere$veg),size = 40,replace = F)})
seleccion_muestras<-data.frame(seleccion_muestras) %>% mutate_all(.funs = ~as.character(paste0(.)))
muestras_elegidas<-seleccion_muestras[,sapply(seleccion_muestras,FUN=function(muestra){
tabla_muestras<-table(piosphere$habitat[muestra])  
all(tabla_muestras==c(8,16,8,8))  
})]
```

Las muestras elegidas son 

```{r}
tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
muestras_elegidas %>% kable(caption=paste0(tab.1_cap,"Muestras seleccionadas")) %>% kable_styling()
ind.tabla<-increment(ind.tabla,1)
```


**6. (1 punto) Realizad un breve análisis de regresión (lineal y múltiple) a partir de las variables que disponéis y utilizando el criterio que responda a alguna pregunta de interés que os hayáis planteado.**

Queremos analizar la relación del número de especies según las caracteristicas medioambientales de las piosferas


Primero calcularemos el número de especies por piosfera (Ya se había hecho en el punto 3) y comprobaremos la normalidad

```{r echo=F}
num.especies<-apply(piosphere$veg,MARGIN = 1,FUN=function(x){sum(x!=0)})
df.modelo.lineal<-cbind(num.especies,piosphere$env)
shapiro.test(df.modelo.lineal$num.especies)
```

```{r fig.cap="Histograma del Número de Especies"}
plot.num.especies <- ggplot(data=df.modelo.lineal, aes(x=num.especies)) + 
  geom_histogram(col="black", 
                 fill="darkorange", 
                 alpha = .6) + 
  labs(title="Número de especies", x="Número de Especies", y="Frecuencia")
  
plot.num.especies
```

Como hemos visto rechazamos la hipotesis de normalidad (p valor inferior  a 0,05 en el test de Shapiro-Wilk), esto junto a que se trata una variable de conteos, vamos a considerar utilizar modelos lineales generalizados basados en la distribución de Poisson.


```{r}
tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
modelo<-glm(formula=num.especies~logDist+pH+Conductivity,data =df.modelo.lineal,family = poisson )
summary(modelo)

dependent = "num.especies"
explanatory = c("logDist", "pH","Conductivity","Skeleton","NO2")
explanatory = df.modelo.lineal %>% dplyr::select(-num.especies,-Blocks) %>% colnames()

explanatory_multi<-c("logDist", "pH","Conductivity","Skeleton")
library(finalfit)
fit_uni = df.modelo.lineal %>% 
    glmuni(dependent, explanatory, family = poisson) %>% 
    fit2df(estimate_name = "Rate ratio (univariable)")

fit_multi = df.modelo.lineal %>% 
    glmmulti(dependent, explanatory_multi, family = poisson) %>% 
    fit2df(estimate_name = "Rate ratio (multivariable)")

# All in one pipe
df.modelo.lineal %>%
    ## Crosstable
    summary_factorlist(dependent, explanatory, cont = "median", fit_id=TRUE)  %>% 
    
    ## Add univariable
    ff_merge(fit_uni, estimate_name = "Rate ratio") %>% 
    
    ## Add multivariable
    ff_merge(fit_multi, estimate_name = "Rate ratio") %>% 
    dependent_label(df.modelo.lineal, dependent) -> t
t %>% kable(caption=paste0(tab.1_cap,"Muestras Modelo de regresión univariante y multivariante")) %>% kable_styling()
ind.tabla<-increment(ind.tabla,1)
```


```{r}
DAW2 <- env[grep("^DAW2",rownames(env)),]
DAW2 <- DAW2 %>% summarise_if(is.numeric, mean)

DAW2 <- env[c(1:25)]
apply(DAW2,2,sd)
apply(DAW2,2,mean)
```



Previo a la realización de un análisis de regresión planteamos aquellas correlaciones que pueden proporcionar información  a nivel ecológico, posteriormente planteamos un análisis visual y estadístico para observar si dichas variables presentan una correlación.


```{r}
#Creamos un df con nuestras variables de interés, para poder realizar un análisis gráfico
nutrients <- cbind(env[4], env[15], env[17], env[18], env[19])

pairs(nutrients)
cor(nutrients)

#No encontramos una correlación marcada para las diferentes características físico-químicas de la muestra. Sin embargo, si podemos observar una relación entre las variables height, spine length y seed length, del data frame de variables fisiológicas.

cor(traits[1:9])

reg <- cbind(traits[1], traits[7], traits[8])
pairs(reg)
```



Un modelo podría ser la producción de la especie, en general, y con subniveles (para cada una de las zonas), y diferentes características propias de la especie.

```{r seistraits}
#Obtenemos una nueva variable para las medias
vegMeans <- as.data.frame(colMeans(veg[sapply(veg, is.numeric)])) 

#Cambiamos el nombre de la columna
names(vegMeans)[names(vegMeans) == "colMeans(veg[sapply(veg, is.numeric)])"] <- "meanSp"

# Creamos un nuevo df con la variable "meanSp" y que incluya únicamente las variables cuantitativas, lo que nos permite calcular correlaciones
traitsc <- cbind(traits[1:9], vegMeans)
```



```{r}
cor(traitsc)
pairs(traitsc)

#Creamos el modelo

linearMod <- lm( meanSp ~ height+ ACD+ leaf.area+ leaf.consistency+ leaf.ratio+ SLA+ spine.length+ seed.length+ diaspore.length, data=traitsc)

summary(linearMod)
```

Como indicaban los valores de correlación, no parece haber una regresión pronunciada entre las características fisiológicas de las especies, y su presencia media. 

Esto podría indicar una variedad en las condiciones ambientales para los diferentes territorios, que implicase la distorsión de posibles correlaciones para ambientes concretos. Podríamos realizar un análisis de regresión multinivel, para cada uno de los diferentes ambientes. O bien, que no exista esa correlación entre características fisiológicas y presencia.

**7. (1 punto) A partir del conjunto de datos que estáis trabajando, plantead un estudio ANOVA y desarrollado si, a partir del estudio previo, se cumplen las condiciones.**

Vamos a analizar si hay diferencias entre la intensidad de los pastoreos dependiendo del tipo de habitat

- GrazInt

Graficamos la distribución de las intensidades de los pastoreos según el tipo de habitat

```{r,echo=F,}
df<-data.frame(GrazInt=piosphere$env$GrazInt,habitat=piosphere$habitat)
```

```{r, eval=T, echo=F, fig.cap="Boxplot de la variable Intensidad de los pastoreos por tipo de habitat"}
p <- ggplot(df, aes(x=habitat, y=GrazInt,fill=habitat)) + 
  geom_boxplot()+scale_fill_manual(values=c("yellow2","white","red4","green4"))+stat_summary(fun.y=mean, geom="point",  size=1)+theme_minimal()
p
```

Observamos que las intensidad en los bebederos de las piosferas que tienen habitat stone poseen una variabilidad mucho mayor que los otros tres habitats, ademas podemos ver como la mediana y la media difieren entre sí. Vemos en la siguiente tabla los valores de los descriptivos basicos media, mediana y desviación típica


```{r eval=T,echo=F}
tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
df %>% dplyr::group_by(habitat) %>% summarize(media=round(mean(GrazInt,na.rm=T),4),mediana=median(GrazInt,na.rm=T),sd=round(sd(GrazInt,na.rm=T),4)) %>% kableExtra::kable(caption=paste0(tab.1_cap,"Media, Mediana y Desviación Típica por habitat")) %>% kableExtra::kable_styling()
ind.tabla<-increment(ind.tabla,1)
```

En la siguiente tabla cuando analizamos la normalidad por tipo de habitat de la variable en estudio observamos que podemos rechazar la hipótesis de normalidad (p valor < 0,05).

```{r eval=T,echo=F}
tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
res.test.normalidad<-df %>% dplyr::group_by(habitat) %>%  dplyr::group_map(.f = ~shapiro.test(.x$GrazInt)) 
res.p.valor.normalidad<-sapply(res.test.normalidad,FUN=function(p.valor.normalidad.habitat){p.valor.normalidad.habitat$p.value})
names(res.p.valor.normalidad)<-levels(df$habitat)
res.p.valor.normalidad %>% kableExtra::kable(col.names = "p valor normalidad",caption=paste0(tab.1_cap,"Análisis de normalidad por habitat")) %>% kable_styling()
ind.tabla<-increment(ind.tabla,1)
```

Al aplicar el test de homogeneidad de varianzas vemos que el p-valor obtenido en el test es inferior a 0,05 lo cual nos indica que no sigue las hipotesis necesarias para hacer el análisis de la varianza.

```{r}
test.homog.varianzas<-fligner.test(df$GrazInt~df$habitat,df)
test.homog.varianzas$p.value
```

```{r  eval=F,echo=F}
anova_df<-aov(GrazInt~habitat,data=df)
summary(anova_df)
plot(anova_df)
resumen.anova<-summary(anova_df)
resumen.anova[[1]]%>% data.frame() %>% kable() %>% kable_styling()
```

En este punto podemos utilizar tres estrategías:

- Hacer alguna transformación para conseguir las condiciones necesarias para aplicar la prueba ANOVA. Una de las estrategias

- Comprobar si hay valores atípicos que al eliminarlos consigamos las condiciones para aplicar la prueba ANOVA.

- Aplicar test no paramétricos (Prueba de Kruskal-Wallis)

Para utilizar la primera estrategía probamos a

- Transformar con logaritmos

- Transformar con raices cuadradas

- Transformaciones BoxCox, utilizadas tipicamente para corregir problemas de normalidad y heterocedasticidad.


Tomando logaritmos:

```{r eval=T, fig.cap="Boxplot de la variable Intensidad de los pastoreos por tipo de habitat (logaritmos)"}
p <- df %>% mutate(log.Graz.Int=log(GrazInt)) %>% ggplot(aes(x=habitat, y=log.Graz.Int,fill=habitat)) + 
  geom_boxplot()+scale_fill_manual(values=c("yellow2","white","red4","green4"))+stat_summary(fun.y=mean, geom="point",  size=1)+theme_minimal()
p
```

Hemos observado que no hemos conseguido ni homogeneizar varianzas, incluso la variabilidad en el tipo de habitat stone ha aumentado, de todas formas comprobaremos la normalidad de la variable transformada a través de los correspondientes test estadísticos.

```{r eval=T}
tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
res.test.normalidad<-df %>% mutate(log.Graz.Int=log(GrazInt)) %>% dplyr::group_by(habitat) %>%  dplyr::group_map(.f = ~shapiro.test(.x$log.Graz.Int)) 
res.p.valor.normalidad<-sapply(res.test.normalidad,FUN=function(p.valor.normalidad.habitat){p.valor.normalidad.habitat$p.value})
names(res.p.valor.normalidad)<-levels(df$habitat)
res.p.valor.normalidad %>% kableExtra::kable(col.names = "p valor normalidad",caption=paste0(tab.1_cap,"Análisis de normalidad por tipo de habitat")) %>% kable_styling()
ind.tabla<-increment(ind.tabla,1)
```

En la tabla anterior podemos observar que al transformar en logaritmos hemos conseguido normalidad en las piosferas de habitat calcareo y de arena de 2008, pero no así en habitat piedra y arena de 2007.

Observamos con el correspondiente test como no tenemos homogeneidad de varianzas, condición para aplicar la prueba ANOVA

```{r}
df.log<-df %>% mutate(log.Graz.Int=log(GrazInt))
test.homog.varianzas<-fligner.test(df.log$log.Graz.Int,df.log$habitat,df.log)
test.homog.varianzas$p.value
```


Analizamos la normalidad de la variable transformada con raices cuadradas

```{r eval=T,  fig.cap="Boxplot de la variable Intensidad de los pastoreos por tipo de habitat (raiz cuadrada)"}
p <- df %>% mutate(sqrt.Graz.Int=sqrt(GrazInt)) %>% ggplot(aes(x=habitat, y=sqrt.Graz.Int,fill=habitat)) + 
  geom_boxplot()+scale_fill_manual(values=c("yellow2","white","red4","green4"))+stat_summary(fun.y=mean, geom="point",  size=1)+theme_minimal()
p
```



```{r eval=T}
tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
res.test.normalidad<-df %>% mutate(sqrt.Graz.Int=sqrt(GrazInt)) %>% dplyr::group_by(habitat) %>%  dplyr::group_map(.f = ~shapiro.test(.x$sqrt.Graz.Int)) 
res.p.valor.normalidad<-sapply(res.test.normalidad,FUN=function(p.valor.normalidad.habitat){p.valor.normalidad.habitat$p.value})
names(res.p.valor.normalidad)<-levels(df$habitat)
res.p.valor.normalidad %>% kableExtra::kable(col.names = "p valor normalidad",caption=paste0(tab.1_cap,"Análisis de normalidad por habitat")) %>% kable_styling()
ind.tabla<-increment(ind.tabla,1)
```

En la tabla anterior podemos observar que al transformar con raices cuadradas hemos conseguido normalidad unicamente en piosferas cuyo habitat arena de 2008, pero no así en habitat calcareo, piedra y arena de 2007.

Observamos con el correspondiente test como no tenemos homogeneidad de varianzas, condición para aplicar la prueba ANOVA

```{r}
df.sqrt<-df %>% mutate(sqrt.Graz.Int=sqrt(GrazInt))
test.homog.varianzas<-fligner.test(df.sqrt$sqrt.Graz.Int,df.sqrt$habitat,df.sqrt)
test.homog.varianzas$p.value
```


Analizamos la normalidad de la variable transformada con la transformación de Box-Cox


```{r eval=T}
library(MASS)
Box <- boxcox(piosphere$env$GrazInt ~ 1,              # Transform Turbidity as a single vector
             lambda = seq(-6,6,0.1)      # Try values -6 to 6 by 0.1
             ,plotit = F)
Cox = data.frame(Box$x, Box$y)   
Cox2 = Cox[with(Cox, order(-Cox$Box.y)),] 
lambda = Cox2[1, "Box.x"]      
T_box = (piosphere$env$GrazInt ^ lambda - 1)/lambda 
```


```{r eval=T,echo=F}
tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
df.boxcox<-data.frame(GrazInt_T_box=T_box,habitat=piosphere$habitat)
```


```{r eval=T,echo=F}
res.test.normalidad<-df.boxcox %>% dplyr::group_by(habitat) %>%  dplyr::group_map(.f = ~shapiro.test(.x$GrazInt_T_box)) 
res.p.valor.normalidad<-sapply(res.test.normalidad,FUN=function(p.valor.normalidad.habitat){p.valor.normalidad.habitat$p.value})
names(res.p.valor.normalidad)<-levels(df$habitat)
res.p.valor.normalidad %>% kableExtra::kable(col.names = "p valor normalidad",caption=paste0(tab.1_cap,"Análisis de normalidad por habitat")) %>% kable_styling()
ind.tabla<-increment(ind.tabla,1)
```

En la tabla anterior podemos observar que al utilizar la familia de transformaciones de BoxCox hemos conseguido normalidad en las piosferas de habitat calcareo y de arena de 2008, pero no así en habitat piedra y arena de 2007.

Observamos con el correspondiente test como no tenemos homogeneidad de varianzas, condición para aplicar la prueba ANOVA

```{r}
test.homog.varianzas<-fligner.test(df.boxcox$GrazInt_T_box,df.boxcox$habitat,df.boxcox)
test.homog.varianzas$p.value
```


Detectaremos los datos atípicos de la muestra utilizando la función boxplot.stats


```{r}
outlier_values <- boxplot.stats(piosphere$env$GrazInt)$out 
outlier_index<- which(!piosphere$env$GrazInt%in%outlier_values)
df.sin.atipicos<-df[outlier_index,]
```


```{r eval=T, fig.cap="Boxplot de la variable Intensidad de los pastoreos por tipo de habitat (Sin outliers)"}
p <- ggplot(df.sin.atipicos, aes(x=habitat, y=GrazInt,fill=habitat)) + 
  geom_boxplot()+scale_fill_manual(values=c("yellow2","white","red4","green4"))+stat_summary(fun.y=mean, geom="point",  size=1)+theme_minimal()
p
```

En el gráfico anterior observamos que hemos reducido la variabilidad en el habitat piedra, pero seguimos viendo la existencia de valores extremos en los cuatro habitats. Mostramos en la siguiente tabla los descriptivos principales para la variable intensidad del pastoreo.

```{r}
tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
df.sin.atipicos %>% dplyr::group_by(habitat) %>% summarize(media=round(mean(GrazInt,na.rm=T),4),mediana=median(GrazInt,na.rm=T),sd=round(sd(GrazInt,na.rm=T),4)) %>% kableExtra::kable(caption=paste0(tab.1_cap,"Media, Mediana y Desviación Típica por habitat")) %>% kableExtra::kable_styling()
ind.tabla<-increment(ind.tabla,1)
```

Cuando analizamos la normalidad por tipo de habitat de la variable en estudio observamos que podemos rechazar la hipótesis de normalidad.

```{r}
tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
res.test.normalidad<-df.sin.atipicos %>% dplyr::group_by(habitat) %>%  dplyr::group_map(.f = ~shapiro.test(.x$GrazInt)) 
res.p.valor.normalidad<-sapply(res.test.normalidad,FUN=function(p.valor.normalidad.habitat){p.valor.normalidad.habitat$p.value})
names(res.p.valor.normalidad)<-levels(df.sin.atipicos$habitat)
res.p.valor.normalidad %>% kableExtra::kable(col.names = "p valor normalidad",caption=paste0(tab.1_cap,"Análisis de normalidad por habitat")) %>% kable_styling()
ind.tabla<-increment(ind.tabla,1)
```

Al aplicar el test de homogeneidad de varianzas vemos que el p-valor obtenido en el test es inferior a 0,05 lo cual nos indica que no sigue las hipotesis necesarias para hacer el análisis de la varianza.

```{r}
test.homog.varianzas<-fligner.test(df.sin.atipicos$GrazInt~df.sin.atipicos$habitat,df)
test.homog.varianzas$p.value
```


Como alternativa a lo hecho anteriormente aplicaremos test no paramétricos, en este caso utilizaremos el test de Kruskal-Wallis, y para las comparaciones entre parejas se utilizará el test de la U de Mann-Withney que es la alternativa no parámetrica al test de la t de Student. Para hacer esto utilizo la función compareGroups de la libreria del mismo nombre que me muestra la tabla con el p valor asociado al test de Kruskal-Wallis así como las comparaciones entre grupos.


```{r}
tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
kruskal.test(df$GrazInt~df$habitat)
compareGroups::compareGroups(formula=habitat~GrazInt,method = 4,data=df) %>% compareGroups::createTable(show.p.mul = T,digits=5) %>% compareGroups::export2md(caption = paste0(tab.1_cap,"Análisis no paramétrico de la intensidad de pastoreos según el tipo de habitat"))
ind.tabla<-increment(ind.tabla,1)
```

En la tabla anterior podemos ver, además de la mediana y el recorrido intercuartilico de la variable intensidad de los pastoreos en cada habitat, el p valor asociado al test de Kruskal-Wallis es inferior a 0.001, lo cual nos indica que podemos rechazar la hipótesis de igualdad de distribuciones según el tipo de habitat.  Ademas vemos que todos los grupos son diferentes entre si al comparar los habitats dos a dos. 




**8. (1 punto) A partir de los datos de origen y el estudio realizado, haced una valoración final. Para ello, podéis basaros en las siguientes preguntas: "disponemos de conclusiones finales?", "sería necesario hacer un análisis más avanzado?", "faltan datos para obtener otro tipo de información como...?",.... **





# Sección 2 (2 puntos) 
Como habréis comprobado, las aplicaciones y herramientas de R son muy amplias. En esta sección, tenéis que definir y desarrollar un ejemplo de aplicación de uno de los  temas que aparecen a continuación. 

Podéis basaros en la información referenciada de la plataforma Datacamp, a la cual tenéis acceso con vuestro correo electrónico de la UOC, o cualquier otra fuente de información que consideréis más oportuna.

Sería conveniente, que el ejemplo a desarrollar sea basado en la fuente de datos de la Sección 1, pero también podéis basaros en otro conjunto de datos.

Los temas a escoger son:
- **Construcción de una aplicación web con Shiny **
- Análisis cluster con R 
- Repositorio Bioconductor en R 


El tema que hemos elegido es el de realizar una pequeña aplicación web  con shiny para 

- Mostrar las tablas de descriptivos

- Graficos de las variables categoricas

pudiendo filtrar que variables queremos mostrar.
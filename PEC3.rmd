---
title: "PEC3"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Sección 1 (8 puntos) 

**1. (0,5 puntos)  Buscad un conjunto de datos relacionados con la Bioestadística o Bioinformática. Para ello, podéis utilizar algunos recursos conocidos como es el caso de http://www.bioinformatics.org/sms2/index.html o de http://biostat.mc.vanderbilt.edu/wiki/Main/DataSets.  **
**También podéis utilizar otros recursos propios que conozcáis o que sean de vuestro interés, y siempre teniendo en cuenta que sean datos públicos que podéis utilizar.  Tenéis que explicar la procedencia de los datos así como incluir las referencias que correspondan y justificar porqué habéis elegido estos datos.** 

<div style="text-align: justify">
Una comprensión holística de los fenómenos ecológicos implica reducir la complejidad natural en factores y relaciones interpretables. Este reduccionismo, viene facilitado por la elaboración de modelos matemáticos que permiten la comprensión de dichos fenómenos, la obtención de conclusiones y la elaboración de predicciones. Típicamente, los sistemas ecológicos han sido clasificados atendiendo a su dinámica en sistemas en equilibrio y sistemas en no-equilibrio, de tal manera que aquellos cambios reversibles pertenecerían a un sistema en equilibrio, y los cambios no reversibles a los sistemas en no-equilibrio. El aumento de la capacidad computacional ha permitido durante las dos últimas décadas abordar modelos multinivel más complejos, que, si bien eran conocidos, no eran aplicables debido una insuficiente capacidad de cálculo. Estos nuevos enfoques determinan que las dinámicas ecológicas están englobadas en un continuo equilibrio, no-equilibrio; en vez de dos estados contrapuestos.  


Las llanuras de Rehoboth, en Namibia central, han permitido a algunos investigadores desarrollar estos nuevos modelos. Esta región semi-árida de estepa y poca vegetación, ha sido durante cientos de años, y sigue siendo hoy en día, zona de pastoreo. A pesar de su contribución reducida al Producto Interior Bruto (PIB), la agricultura es un sector que se mantiene como fundamental para la mayoría de la población (algo más de dos millones de habitantes en 2019). De forma directa o indirecta, mantiene aproximadamente al 70% de la población del país.   [http://www.fao.org/namibia/fao-in-namibia/namibia-at-a-glance/en/]  


La elaboración de modelos que permitan realizar una explotación óptima de la estepa, a la vez que mantienen la dinámica de los pastizales, puede suponer enormes beneficios sobre la economía y salud de las personas.
Nuestra atención se centra en el estudio elaborado por Wesuls, D. et al [1], y los datos obtenidos a partir de este (que se pueden encontrar en el repositorio "biosphere" en el paquete *ade4* de R). Este estudio, emplea un conjunto jerárquico de modelos ecológicamente significativos con una complejidad creciente: el enfoque HOF (Huisman – Olff – Fresco) [enlace], para investigar las respuestas de pastoreo de las especies, los parámetros de diversidad y los valores de cobertura agrupados para dos rasgos: forma de crecimiento y ciclo de vida.
1.*The grazing fingerprint: Modelling species responses and trait patterns alonggrazing gradients in semi-arid Namibian rangelands*  
<div/>  


**2. (0,5 puntos) Utilizando R, mostrad y explicad qué tipo de fichero habéis importado y las variables que forman parte de él (tipo, clasificación,...), así como todo aquello que creáis relevante. Incluir capturas de pantalla y las instrucciones en R que habéis utilizado para importar y  mostrar los datos.** 

Hemos utilizado un dataset que pertenece al paquete de R llamado ade4.  La manera de importar es con la función *data* del paquete base de R. En este caso no es necesario utilizar funciones como read.delim, read.csv o read.table de las utilidades de R que son las habituales para importar ficheros de texto, o la función read.xlsx de la librería xlsx para importar ficheros en formato excel, o read.spss del paquete foreign para leer ficheros procedentes del paquete estadístico SPSS.

La particularidad de este dataset es que viene definido a través de un objeto *lista* llamado *piosphere*. 
Este objeto lista está formado a su vez por cuatro objetos

<!-- La presión que ejercen los animales sobre los recursos, no se presenta -->
<!-- uniformemente a lo largo del lote, esta ampliamente aceptado que la presión es -->
<!-- mayor cerca de los puntos en donde los animales se reúnen a beber. Lange -->
<!-- (1969) emplea el termino “piosfera” para describir esta relación entre las -->
<!-- aguadas y los animales en pastoreo. Por lo tanto se entiende como piosfera al -->
<!-- sitio que rodea los puntos de bebidas en donde la presión por pastoreo sobre el -->
<!-- suelo y la vegetación, es muy intensa y esta presión disminuye con distancias -->
<!-- crecientes a los puntos de bebida.  -->

- Data frame que se llama **veg** que tiene la información sobre la proporción de cada  cada una de las especies en la superficie superior de la vegetación. Cada una de las filas se corresponde a los datos de las piosferas elegidas. Tenemos 378 piosferas y 87 tipos de especies.
- Data frame que se llama **traits** que tiene la información de las características o rasgos de las plantas. Cada una de las filas se corresponde a los valores de las columnas del data frame **veg**. Es decir en este data frame tendremos 87 filas y 21 características
- Data frame que se llama **env** que contiene la información de variables medioambientales relativas a las 378 piosferas que se han estudiado. Se han recopilado 25 variables
- Vector llamado **habitat** es una variable tipo factor que describe el tipo de habitat de cada una de las piosferas.

```{r carga_librerias,echo=T, message=F, warning=F,comment=F}
require(ade4)
library(ade4)
library(dplyr)
library(ggplot2)
library(kableExtra)
library(captioner)
library(ade4)
library(gridExtra)
library(pROC)
library(cutpointr)
ind.tabla<-1
ind.figura<-0
table_nums <- captioner(prefix = "Tabla.")
```


```{r echo=T, message=F, warning=F,comment=F}
data("piosphere")
```


```{r echo=F}
tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
piosphere$veg %>% head() %>% kable(caption = paste0(tab.1_cap,"Primeras seis filas de Data Frame veg")) %>% kable_styling()
ind.tabla <- increment(ind.tabla,1)

tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
piosphere$veg %>% tail() %>% kable(caption = paste0(tab.1_cap,"Últimas seis filas de Data Frame veg")) %>% kable_styling()
ind.tabla <- increment(ind.tabla,1)
```

```{r echo=F}
tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
piosphere$traits %>% head() %>% kable(caption = paste0(tab.1_cap,"Primeras seis filas de Data Frame traits")) %>% kable_styling()
ind.tabla <- increment(ind.tabla,1)
```


```{r echo=F}
tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
sapply(piosphere$traits,class)%>% kable(caption = paste0(tab.1_cap,"Clasificación de las variables que definen los rasgos de las especies"),col.names = "Tipo de Variable") %>% kable_styling()
ind.tabla <- increment(ind.tabla,1)
```


```{r echo=F}
tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
piosphere$env %>% head() %>% kable(caption = paste0(tab.1_cap,"Primeras seis filas de Data Frame env")) %>% kable_styling()
ind.tabla <- increment(ind.tabla,1)

tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
sapply(piosphere$env,class)%>% kable(caption = paste0(tab.1_cap,"Clasificación de las variables que definen las variables medioambientales recogidas"),col.names = "Tipo de Variable") %>% kable_styling()
ind.tabla <- increment(ind.tabla,1)
```

```{r echo=F}
tab.1_cap<-table_nums(name=paste0("tab",ind.tabla))
piosphere$habitat %>% head() %>% kable(caption = paste0(tab.1_cap,"Primeros seis elementos de Vector habitat"),col.names = "Tipo de Habitat") %>% kable_styling()
ind.tabla <- increment(ind.tabla,1)
```


**3. (1,5 puntos) Realizad un mínimo de seis preguntas objetivo que den una idea de la información contenida en el conjunto de datos escogido, es decir, obtener información del conjunto de datos a partir de determinados criterios, según variables, o rangos de valores, etc... Para ello, podéis basaros en el tipo de consultas realizadas en la PEC1 y también utilizando, en alguno de los casos, la definición de funciones tal como se trabaja en el LAB3.**

- Se me ocurre mostrar el porcentaje de especies que tienen datos en cada una de las piosferas

- A colación de este, las diferencias porcentuales que puede haber entre las ST y las LT.

- Mostrar la especie mayoritaria en cada una de las especies o sacar las caracteristicas relacionadas con dicha especie para cada piosfera

- Mostrar la especie que tiene el valor maximo para cada una de las caracteristicas del data.frame traits 

- Mostrar cuantas especies cuyo ciclo vital es anual tienen consistencia de hoja mesomorfica suave

- Mostrar que piosferas tienen mayor inclinacion de la media

- Mostrar que piosferas tienen valores nitritos, nitratos y phosphatos por encima del 75%
  
- A colación de este, mostrar la distribución de pH, a que piosferas pertenecen la correlación con los nutrientes. (ej6)

- Limitaciones de los índices de diversidad (simpson) en el contexto agronómico.
[http://www.umass.edu/landeco/research/fragstats/documents/Metrics/Diversity%20Metrics/Limitations.htm] 


**4. (1,5 puntos) Realizad un análisis descriptivo de los datos. Este estudio debe incluir, un resumen paramétrico de los datos y diversas representaciones gráficas de los mismos basadas en determinados criterios. Dejamos a vuestra elección el tipo de gráficos y los criterios utilizados.**

Para los diferentes data.frames contenidos en la base de datos *piosphere*, vamos a realizar un estudio paramétrico, obteniendo proporciones, tasas, razones y promedios para algunas de sus variables, así como representaciones gráficas que permitan una aproximación intuitiva a las particularidades de nuestra base de datos.


Obtenemos tres data frames para cada una de las listas.
```{r}
veg <- piosphere$veg
traits <- piosphere$traits
env <- piosphere$env
```



#Con respecto al df veg, previo al análisis paramétrico es necesario tratar los datos.
#No se me ocurre una alternativa a agrupar las diferentes subáreas.


```{r}
#split(veg,sub("-.*","",data$V1))
```


Para el data frame **traits** nos vamos a centrar en algunas de las variables que nos parecen significativas en su contexto ecológico.

Proporciones y parámetros de centralidad y dispersión para diferentes variables. 
Las variables 

- *height* 
- *leaf traits*
- *diaspore length* 
- *life cycle* 

nos van a proporcionar información sobre el conjunto de especies englobadas en nuestro dataset, e incluso, sobre las características del bioma al que pertenecen. 

(#No he conseguido encontrar referencias al significado de las variables SLA y CDA)
Specific leaf area (quant) SLA Specific leaf area (mm² mg1), i.e. leaf area divided by dry weight of the leaf

Above cover density (quant) ACD Percentage cover of the plant canopy above a vertically projected contour of the plant

Variable *height*


```{r cuatro_traits}
#Medidas de distribución
attach(traits)
range(traits$height)
quantile(traits$height)


#Medidas de centralidad y dispersión
mean(traits$height)
median(traits$height)
sd(traits$height)


#Histograma
ggplot(data=traits, aes(x=height)) + 
  geom_histogram(breaks=seq(0, 400, by=50), 
                 col="black", 
                 fill="steelblue", 
                 alpha = .6) + 
  labs(title="Histograma para las alturas", x="Altura", y="Frecuencia")
```


Variable *diaspore length*

```{r, warning=FALSE}
#Medidas de distribución
attach(traits)
range(diaspore.length)
quantile(diaspore.length)


#Medidas de centralidad y dispersión
mean(diaspore.length)
median(diaspore.length)
sd(diaspore.length)


#Histograma en log
logDhist <- ggplot(data=traits, aes(x=log(traits$diaspore.length))) + 
  geom_histogram(col="black", 
                 fill="darkgreen", 
                 alpha = .6,
                 binwidth=0.5) + 
  labs(title="Histograma para la longitud de las diásporas", x="Longitud de la diáspora", y="Frecuencia")


#Boxplot en log
logDboxplot <- ggplot(data=traits, aes(y=log(traits$diaspore.length))) + 
  geom_boxplot(col="black", 
                 fill="darkgreen", 
                 alpha = .6,
                 binwidth=5) + 
  labs(title="Histograma para la longitud de las diásporas", y="Longitud", x="Diáspora")



grid.arrange(logDhist, logDboxplot, ncol=2)
```



```{r}
#Frecuencias y proporciones
table(traits$life.cycle) %>% kable(col.names = c("Life Cycle","Freq")) %>% kable_styling()
# table(traits$life.cycle)/sum(table(traits$life.cycle)) %>% kable() %>% kable_styling()
round(100*prop.table(table(traits$life.cycle)),4) %>% kable(col.names = c("Life Cycle","Proporción")) %>% kable_styling()

```



Variable Leaf Traits
Photosynthetic traits were strongly coordinated, and specific leaf area predicted mass‐based rates of assimilation and respiration; leaf life span predicted many other leaf characteristics. Leaf traits were closely associated with growth, survival, and light requirement of the species.
[https://esajournals.onlinelibrary.wiley.com/doi/abs/10.1890/0012-9658%282006%2987%5B1733%3ALTAGPO%5D2.0.CO%3B2#:~:text=Photosynthetic%20traits%20were%20strongly%20coordinated,light%20requirement%20of%20the%20species.]


The environment in which plants grow and the organisms that eat them can sculpt their features or ‘traits’ including the area, weight, and thickness of their leaves, the number of seeds they produce, the height they reach, and the amount and type of roots they grow (Diaz et al. 2015). These traits, in turn, can determine the effectiveness of each species – and the combination of species in a location – in capturing energy from the sun or nutrients from the soil.
[https://natureecoevocommunity.nature.com/users/105785-jennifer-firn/posts/43150-leaf-traits-are-barometers-of-short-term-perturbations-in-grasslands-but-operating-instructions-apply]

Ecologists use changes in leaf traits to compare plant growth strategies and subsequently infer how ecosystems function (Funk et al. 2017).


```{r}
hist(traits$leaf.height)


height <- traits[1]
# height <- traits$height
leaf.height <- 100*traits[4]
# leaf.height <- 100*traits$leaf.height


ggplot(data=traits, aes(x=height)) + 
  geom_density(fill="darkgreen", alpha = .4, binwidth=0.5)
ggplot(data=traits, aes(x=leaf.height)) + 
  geom_density(fill="steelblue", alpha = .4, binwidth=0.5)


traitHeights<- cbind(height, leaf.height)
pairs(traitHeights)


#Gráfico conjunto para la altura de la hoja y la altura total de la planta.
#ggplot(data=traitHeights, aes(height, leaf.height)) + 
#  geom_histogram(aes(x= heigth, y = ..density..), col="black", fill="steelblue", alpha = .6) + 
#  geom_histogram(aes(x=leaf.height, y = ..density..), col="black", fill="darkgreen", alpha = .6) + 
#  labs(title="Histograma para la longitud de las diásporas", x="Longitud de la diáspora", y="Frecuencia")

```




**Dataframe Env**

Las variables fisico-químicas nos van a proporcionar una información amplia sobre los requerimientos nutricionales y ambientales que puede presentar nuestra muestra de estudio, y la flora de la región a la que pertenece. Va a ser fundamental en la elaboración de hipótesis y la obtención de conclusiones.  A continuación presentamos las proporciones, así como parámetros de centralidad y dispersión, y representaciones gráficas para algunas de las variables.

Variable pH

```{r cuatro_env}
#Medidas de distribución
range(env$pH)
quantile(env$pH)


#Medidas de centralidad y dispersión
mean(env$pH)
median(env$pH)
sd(env$pH)


#Histograma
ggplot(data=env, aes(x=pH)) + 
  geom_histogram(col="black", 
                 fill="steelblue", 
                 alpha = .6) + 
  labs(title="Histograma para el pH", x="pH", y="Frecuencia")
```


Variable nutrientes

```{r}

#Medidas de Distribución, NO2, NO3, PO4
range(env$NO2)
quantile(env$NO2)

range(env$NO3)
quantile(env$NO3)

range(env$PO4)
quantile(env$PO4)


#Medidas de centralidad y dispersión  NO2, NO3, PO4
mean(env$NO2)
sd(env$NO2)

mean(env$NO3)
sd(env$NO3)

mean(env$PO4)
sd(env$PO4)
```


```{r}
#Representaciones gráficas


```



**5. (1 punto) Realizad, basándoos en los conceptos trabajados en el LAB4 y PEC2, un mínimo de tres enunciados que respondan a una cuestión de probabilidad y un mínimo de un enunciado que corresponda a un breve modelo de simulación. En este caso, si vuestro conjunto de datos no propicia estos enunciados, podéis generar una o diversas distribuciones en base a unos parámetros determinados definidos por vosotros. **

#### Cuestiones relativas a probabilidad

Vamos a suponer que el logaritmo de la distancia al punto de agua siguiera una distribución normal de media `r round(mean(piosphere$env$logDist),2)` y desviación típica `r round(sd(piosphere$env$logDist),2)`

Calcularemos la probabilidad de que un punto de agua (en logaritmo) este a una distancia inferior a 4 metros.

```{r}
cuestion.1<-pnorm(q = 4,mean = mean(piosphere$env$logDist),sd = sd(piosphere$env$logDist))
```
La probabilidad de que un punto de agua este a una distancia inferior a 4 metros es de `r cuestion.1`


Calcularemos la probabilidad de que un punto de agua (en logaritmo) este a una distancia superior a 8 metros.

```{r}
cuestion.2<-1-pnorm(q = 8,mean = mean(piosphere$env$logDist),sd = sd(piosphere$env$logDist))
```
La probabilidad de que un punto de agua este a una distancia superior de 8 metros es de `r cuestion.2`


Vamos a tener que hacer un análisis de las diferentes especies que tenemos, suponemos que el análisis de una caracteristica como la posición de la flor (variable position.flower) no es fácil de medir y queremos ver cual de las otras caractéristicas(continuas) de las flores nos sirven para predecir con buena probabilidad la posición de la flor.

Utilizando la técnica de curvas ROC primero buscaremos cual es la característica que nos da un AUC mayor 
<!-- control = exposed, case = not exposed -->


```{r message=F}
piosphere$traits %>% select(leaf.ratio,flower.position)
tipos.de.variables<-sapply(piosphere$traits,class)
variables.estudio<-colnames(piosphere$traits)[tipos.de.variables=="numeric"]
lista.de.curvas.roc<-lapply(variables.estudio,FUN=function(variable){
roc_obj <- pROC::roc(piosphere$traits$flower.position, piosphere$traits[,variable])  
})
names(lista.de.curvas.roc)<-variables.estudio
lista.auc<-sapply(lista.de.curvas.roc,FUN=function(curva.roc){curva.roc$auc})
names(lista.auc)<-variables.estudio
data.frame(lista.auc) %>% kable(col.names = "AUC") %>% kable_styling()

```

Observamos que la carácteristica con mayor AUC es el ratio de la hoja

Los datos exactos para la prueba los vemos en la siguiente tabla. Podemos decir que si el ratio de la hoja es menor de 23,28 la probabilidad que nuestra posición de la flor sea  no expuesta es del 100% ya que la especificidad de nuestro test es de 1.

También podemos decir que si el ratio de la hoja es mayor de 23,28 con una probabilidad del 37,87% la posición de la flor será expuesta.

Con una probabilidad del 75,86% la posición floral en nuestra muestra es expuesta.


```{r}
cp <- cutpointr(data = piosphere$traits,class = flower.position , x = leaf.ratio, 
                method = maximize_metric, metric = sum_sens_spec)

cp %>% kable() %>% kable_styling()
```


#### Cuestión relativa a simulación 

- Suponemos que tenemos que elegir 40 piosferas para hacer un subanalisis, de las cuales 8 tienen que ser calc, 16 sand07, 8 sand08, y 8 stone. Haremos una simulación de extracción y comprobaremos si alguna de las muestras elegidas cumple esos criterios.


```{r}
set.seed(385)
seleccion_muestras<-replicate(n = 1000,{muestra=sample(x = rownames(piosphere$veg),size = 40,replace = F)})
seleccion_muestras<-data.frame(seleccion_muestras) %>% mutate_all(.funs = ~as.character(paste0(.)))
muestras_elegidas<-seleccion_muestras[,sapply(seleccion_muestras,FUN=function(muestra){
tabla_muestras<-table(piosphere$habitat[muestra])  
all(tabla_muestras==c(8,16,8,8))  
})]
```

Las muestras elegidas son 

```{r}
muestras_elegidas %>% kable %>% kable_styling()
```


**6. (1 punto) Realizad un breve análisis de regresión (lineal y múltiple) a partir de las variables que disponéis y utilizando el criterio que responda a alguna pregunta de interés que os hayáis planteado.**

Previo a la realización de un análisis de regresión podemos un análisis visual y estadístico para observar que variables pueden presentar dicha correlación.  

```{r}
#Creamos un df con nuestras variables de interés, para poder realizar un análisis gráfico
nutrients <- cbind(env[4], env[15], env[17], env[18], env[19])

pairs(nutrients)
cor(nutrients)

#No encontramos una correlación marcada para las diferentes características físico-químicas de la muestra. Sin embargo, si podemos observar una relación entre las variables height, spine length y seed length, del data frame de variables fisiológicas.

cor(traits[1:9])

reg <- cbind(traits[1], traits[7], traits[8])
pairs(reg)
```



Un modelo podría ser la producción de la especie, en general, y con subniveles (para cada una de las zonas), y diferentes características propias de la especie.

```{r seistraits}
#Obtenemos una nueva variable para las medias
vegMeans <- as.data.frame(colMeans(veg[sapply(veg, is.numeric)])) 

#Cambiamos el nombre de la columna
names(vegMeans)[names(vegMeans) == "colMeans(veg[sapply(veg, is.numeric)])"] <- "meanSp"

# Creamos un nuevo df con la variable "meanSp" y que incluya únicamente las variables cuantitativas, lo que nos permite calcular correlaciones
traitsc <- cbind(traits[1:9], vegMeans)
```



```{r}
cor(traitsc)
pairs(traitsc)

#Creamos el modelo

linearMod <- lm( meanSp ~ height+ ACD+ leaf.area+ leaf.consistency+ leaf.ratio+ SLA+ spine.length+ seed.length+ diaspore.length, data=traitsc)

summary(linearMod)
```

Como indicaban los valores de correlación, no parece haber una regresión pronunciada entre las características fisiológicas de las especies, y su presencia media. 

Esto podría indicar una variedad en las condiciones ambientales para los diferentes territorios, que implicase la distorsión de posibles correlaciones para ambientes concretos. Podríamos realizar un análisis de regresión multinivel, para cada uno de los diferentes ambientes. O bien, que no exista esa correlación entre características fisiológicas y presencia.

```{r seisveg}

#Regresionmultinivel: veg ~ variables

```

<<<<<<< HEAD





6. (1 punto) Realizad un breve análisis de regresión (lineal y múltiple) a partir de las variables que disponéis y utilizando el criterio que responda a alguna pregunta de interés que os hayáis planteado.
=======
>>>>>>> 06c0aa62f9c6e30419bd9f88cb99a12c20397216

**7. (1 punto) A partir del conjunto de datos que estáis trabajando, plantead un estudio ANOVA y desarrollado si, a partir del estudio previo, se cumplen las condiciones.**

Vamos a analizar si hay diferencias entre la intensidad de los pastoreos dependiendo del tipo de habitat

- GrazInt

Graficamos la distribución de las intensidades de los pastoreos según el tipo de habitat

```{r}
df<-data.frame(GrazInt=piosphere$env$GrazInt,habitat=piosphere$habitat)
```

```{r}
p <- ggplot(df, aes(x=habitat, y=GrazInt,fill=habitat)) + 
  geom_boxplot()+scale_fill_manual(values=c("yellow2","white","red4","green4"))+stat_summary(fun.y=mean, geom="point",  size=1)+theme_minimal()
p
```


```{r}
df %>% dplyr::group_by(habitat) %>% summarize(media=round(mean(GrazInt,na.rm=T),4),mediana=median(GrazInt,na.rm=T),sd=round(sd(GrazInt,na.rm=T),4)) %>% kableExtra::kable(caption="Media, Mediana y Desviación Típica por color") %>% kableExtra::kable_styling()
```

```{r}
res.test.normalidad<-df %>% dplyr::group_by(habitat) %>%  dplyr::group_map(.f = ~shapiro.test(.x$GrazInt)) 
res.p.valor.normalidad<-sapply(res.test.normalidad,FUN=function(p.valor.normalidad.habitat){p.valor.normalidad.habitat$p.value})
names(res.p.valor.normalidad)<-levels(df$habitat)
res.p.valor.normalidad %>% kableExtra::kable(col.names = "p valor normalidad") %>% kable_styling()

```

```{r}
test.homog.varianzas<-fligner.test(df$GrazInt~df$habitat,df)
test.homog.varianzas$p.value

```
```{r}
anova_df<-aov(GrazInt~habitat,data=df)
resumen.anova<-summary(anova_df)
resumen.anova[[1]]%>% data.frame() %>% kable() %>% kable_styling()
```


```{r}
library(MASS)
Box <- boxcox(piosphere$env$GrazInt ~ 1,              # Transform Turbidity as a single vector
             lambda = seq(-6,6,0.1)      # Try values -6 to 6 by 0.1
             )
Cox = data.frame(Box$x, Box$y)   
Cox2 = Cox[with(Cox, order(-Cox$Box.y)),] 
lambda = Cox2[1, "Box.x"]      
T_box = (piosphere$env$GrazInt ^ lambda - 1)/lambda 
plotNormalHistogram(T_box)
shapiro.test(piosphere$env$GrazInt ^ lambda)



```{r}

df<-data.frame(GrazInt=T_box,habitat=piosphere$habitat)
res.test.normalidad<-df %>% dplyr::group_by(habitat) %>%  dplyr::group_map(.f = ~shapiro.test(.x$GrazInt)) 
res.p.valor.normalidad<-sapply(res.test.normalidad,FUN=function(p.valor.normalidad.habitat){p.valor.normalidad.habitat$p.value})
names(res.p.valor.normalidad)<-levels(df$habitat)
res.p.valor.normalidad %>% kableExtra::kable(col.names = "p valor normalidad") %>% kable_styling()

```

```


**8. (1 punto) A partir de los datos de origen y el estudio realizado, haced una valoración final. Para ello, podéis basaros en las siguientes preguntas: "disponemos de conclusiones finales?", "sería necesario hacer un análisis más avanzado?", "faltan datos para obtener otro tipo de información como...?",.... **







# Sección 2 (2 puntos) 
Como habréis comprobado, las aplicaciones y herramientas de R son muy amplias. En esta sección, tenéis que definir y desarrollar un ejemplo de aplicación de uno de los  temas que aparecen a continuación. 

Podéis basaros en la información referenciada de la plataforma Datacamp, a la cual tenéis acceso con vuestro correo electrónico de la UOC, o cualquier otra fuente de información que consideréis más oportuna.

Sería conveniente, que el ejemplo a desarrollar sea basado en la fuente de datos de la Sección 1, pero también podéis basaros en otro conjunto de datos.

Los temas a escoger son:
- Construcción de una aplicación web con Shiny 
- Análisis cluster con R 
- Repositorio Bioconductor en R 
